{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Bobing%20Corp/Desktop/bobing-ssot-new/app/categories/page.js"],"sourcesContent":["// app/categories/page.js\r\n\"use client\";\r\nimport { useState, useEffect } from 'react';\r\nimport { db } from '@/lib/firebase';\r\nimport { collection, getDocs, addDoc, doc, updateDoc, deleteDoc, query, orderBy, serverTimestamp, writeBatch } from 'firebase/firestore';\r\n\r\nexport default function CategoriesPage() {\r\n    const [categories, setCategories] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [modalOpen, setModalOpen] = useState(false);\r\n    const [formData, setFormData] = useState({});\r\n    const [syncing, setSyncing] = useState(false);\r\n\r\n    useEffect(() => { fetchData(); }, []);\r\n\r\n    const fetchData = async () => {\r\n        try {\r\n            const q = query(collection(db, \"categories\"), orderBy(\"name\", \"asc\"));\r\n            const snap = await getDocs(q);\r\n            const data = [];\r\n            snap.forEach(d => data.push({id: d.id, ...d.data()}));\r\n            setCategories(data);\r\n        } catch (e) { console.error(e); } finally { setLoading(false); }\r\n    };\r\n\r\n    const syncFromProducts = async () => {\r\n        setSyncing(true);\r\n        try {\r\n            const pSnap = await getDocs(collection(db, \"products\"));\r\n            const uniqueNames = new Set();\r\n            pSnap.forEach(d => { const cat = d.data().category; if(cat) uniqueNames.add(cat.trim()); });\r\n            \r\n            const existingNames = new Set(categories.map(c => c.name));\r\n            const batch = writeBatch(db);\r\n            let count = 0;\r\n            \r\n            uniqueNames.forEach(name => {\r\n                if(!existingNames.has(name)) {\r\n                    const ref = doc(collection(db, \"categories\"));\r\n                    batch.set(ref, { name: name, created_at: serverTimestamp() });\r\n                    count++;\r\n                }\r\n            });\r\n            \r\n            if(count > 0) { await batch.commit(); fetchData(); alert(`Synced ${count} categories.`); }\r\n            else alert(\"All synced.\");\r\n        } catch(e) { alert(\"Sync error: \" + e.message); } \r\n        finally { setSyncing(false); }\r\n    };\r\n\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault();\r\n        try {\r\n            if (formData.id) await updateDoc(doc(db, \"categories\", formData.id), { name: formData.name });\r\n            else await addDoc(collection(db, \"categories\"), { name: formData.name, created_at: serverTimestamp() });\r\n            setModalOpen(false); fetchData();\r\n        } catch (e) { alert(e.message); }\r\n    };\r\n\r\n    const deleteCategory = async (id) => {\r\n        if(confirm(\"Delete category?\")) { await deleteDoc(doc(db, \"categories\", id)); fetchData(); }\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-8 max-w-7xl mx-auto\">\r\n            <div className=\"flex justify-between items-center bg-white p-6 rounded-xl shadow-sm border border-slate-100\">\r\n                <div>\r\n                    <h2 className=\"text-2xl font-bold text-slate-800\">Master Categories</h2>\r\n                    <p className=\"text-sm text-slate-500\">Product classification.</p>\r\n                </div>\r\n                <div className=\"flex gap-2\">\r\n                    <button onClick={syncFromProducts} disabled={syncing} className=\"bg-indigo-50 hover:bg-indigo-100 text-indigo-700 px-4 py-2.5 rounded-lg text-sm font-bold transition-all border border-indigo-200 disabled:opacity-50\">\r\n                        {syncing ? 'Syncing...' : 'Sync from Products'}\r\n                    </button>\r\n                    <button onClick={() => { setFormData({name:''}); setModalOpen(true); }} className=\"bg-indigo-600 hover:bg-indigo-700 text-white px-5 py-2.5 rounded-lg text-sm font-bold shadow-lg transition-all\">\r\n                        + New Category\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden\">\r\n                <table className=\"min-w-full divide-y divide-slate-100\">\r\n                    <thead className=\"bg-slate-50\">\r\n                        <tr>\r\n                            <th className=\"px-6 py-4 text-left text-xs font-bold text-slate-500 uppercase w-full\">Category Name</th>\r\n                            <th className=\"px-6 py-4 text-right text-xs font-bold text-slate-500 uppercase w-32\">Actions</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody className=\"bg-white divide-y divide-slate-50\">\r\n                        {loading ? <tr><td colSpan=\"2\" className=\"text-center py-8\">Loading...</td></tr> : categories.map(c => (\r\n                            <tr key={c.id} className=\"hover:bg-slate-50\">\r\n                                <td className=\"px-6 py-4 font-bold text-slate-800\">{c.name}</td>\r\n                                <td className=\"px-6 py-4 text-right space-x-2\">\r\n                                    <button onClick={() => { setFormData({...c}); setModalOpen(true); }} className=\"text-blue-600 hover:text-blue-800 font-bold text-sm\">Edit</button>\r\n                                    <button onClick={() => deleteCategory(c.id)} className=\"text-red-400 hover:text-red-600 font-bold text-sm\">Del</button>\r\n                                </td>\r\n                            </tr>\r\n                        ))}\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n\r\n            {modalOpen && (\r\n                <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/50 backdrop-blur-sm p-4\">\r\n                    <div className=\"bg-white rounded-2xl shadow-2xl max-w-sm w-full p-8\">\r\n                        <h3 className=\"text-xl font-bold mb-6 text-slate-800\">{formData.id ? 'Edit Category' : 'New Category'}</h3>\r\n                        <form onSubmit={handleSubmit} className=\"space-y-5\">\r\n                            <div>\r\n                                <label className=\"block text-sm font-bold mb-1\">Name</label>\r\n                                <input type=\"text\" required className=\"w-full border p-2.5 rounded-lg\" value={formData.name} onChange={e => setFormData({...formData, name: e.target.value})} />\r\n                            </div>\r\n                            <div className=\"flex justify-end gap-3 pt-4 border-t\">\r\n                                <button type=\"button\" onClick={() => setModalOpen(false)} className=\"px-4 py-2 text-slate-600 hover:bg-slate-100 rounded font-bold\">Cancel</button>\r\n                                <button type=\"submit\" className=\"px-5 py-2 bg-indigo-600 text-white rounded font-bold hover:bg-indigo-700 shadow-lg\">Save</button>\r\n                            </div>\r\n                        </form>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}"],"names":[],"mappings":"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"}}]
}