{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Bobing%20Corp/Desktop/bobing-ssot-new/lib/utils.js"],"sourcesContent":["// lib/utils.js\r\nexport const formatRupiah = (n) => {\r\n  return new Intl.NumberFormat('id-ID', {\r\n    style: 'currency',\r\n    currency: 'IDR',\r\n    minimumFractionDigits: 0\r\n  }).format(n);\r\n};\r\n\r\nexport const sizeRank = ['ALL','ALL SIZE','ALLSIZE','XXXS','XXS','XS','S','M','L','XL','XXL','2XL','3XL','XXXL','4XL','5XL'];\r\n\r\nexport const sortBySize = (variantA, variantB) => {\r\n  const sizeA = (variantA.size || '').toUpperCase().trim();\r\n  const sizeB = (variantB.size || '').toUpperCase().trim();\r\n  const idxA = sizeRank.indexOf(sizeA);\r\n  const idxB = sizeRank.indexOf(sizeB);\r\n  \r\n  if (idxA !== -1 && idxB !== -1) return idxA - idxB;\r\n  if (idxA !== -1) return -1; \r\n  if (idxB !== -1) return 1;\r\n  \r\n  const colorCompare = (variantA.color || '').localeCompare(variantB.color || '');\r\n  if (colorCompare !== 0) return colorCompare;\r\n  \r\n  return (variantA.sku || '').localeCompare(variantB.sku || '');\r\n};"],"names":[],"mappings":"AAAA,eAAe;;;;;;;;;AACR,MAAM,eAAe,CAAC;IAC3B,OAAO,IAAI,KAAK,YAAY,CAAC,SAAS;QACpC,OAAO;QACP,UAAU;QACV,uBAAuB;IACzB,GAAG,MAAM,CAAC;AACZ;AAEO,MAAM,WAAW;IAAC;IAAM;IAAW;IAAU;IAAO;IAAM;IAAK;IAAI;IAAI;IAAI;IAAK;IAAM;IAAM;IAAM;IAAO;IAAM;CAAM;AAErH,MAAM,aAAa,CAAC,UAAU;IACnC,MAAM,QAAQ,CAAC,SAAS,IAAI,IAAI,EAAE,EAAE,WAAW,GAAG,IAAI;IACtD,MAAM,QAAQ,CAAC,SAAS,IAAI,IAAI,EAAE,EAAE,WAAW,GAAG,IAAI;IACtD,MAAM,OAAO,SAAS,OAAO,CAAC;IAC9B,MAAM,OAAO,SAAS,OAAO,CAAC;IAE9B,IAAI,SAAS,CAAC,KAAK,SAAS,CAAC,GAAG,OAAO,OAAO;IAC9C,IAAI,SAAS,CAAC,GAAG,OAAO,CAAC;IACzB,IAAI,SAAS,CAAC,GAAG,OAAO;IAExB,MAAM,eAAe,CAAC,SAAS,KAAK,IAAI,EAAE,EAAE,aAAa,CAAC,SAAS,KAAK,IAAI;IAC5E,IAAI,iBAAiB,GAAG,OAAO;IAE/B,OAAO,CAAC,SAAS,GAAG,IAAI,EAAE,EAAE,aAAa,CAAC,SAAS,GAAG,IAAI;AAC5D"}},
    {"offset": {"line": 57, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Bobing%20Corp/Desktop/bobing-ssot-new/app/finance-reports/page.js"],"sourcesContent":["\"use client\";\r\nimport { useState, useEffect } from 'react';\r\nimport { db } from '@/lib/firebase';\r\nimport { collection, getDocs, query, where } from 'firebase/firestore';\r\nimport { formatRupiah } from '@/lib/utils';\r\n\r\n// Konfigurasi Cache\r\nconst CACHE_PREFIX = 'lumina_report_';\r\nconst CACHE_DURATION = 5 * 60 * 1000; // 5 Menit\r\n\r\nexport default function ReportPLPage() {\r\n    const [data, setData] = useState({ revenue: 0, cogs: 0, expenses: 0, details: {} });\r\n    const [loading, setLoading] = useState(false);\r\n    const [range, setRange] = useState({ \r\n        start: new Date(new Date().getFullYear(), new Date().getMonth(), 1).toISOString().split('T')[0], \r\n        end: new Date(new Date().getFullYear(), new Date().getMonth() + 1, 0).toISOString().split('T')[0] \r\n    });\r\n\r\n    // Generate Report (Smart Caching)\r\n    const generateReport = async (forceRefresh = false) => {\r\n        setLoading(true);\r\n        \r\n        // 1. Generate Cache Key berdasarkan Tanggal\r\n        const cacheKey = `${CACHE_PREFIX}${range.start}_${range.end}`;\r\n\r\n        try {\r\n            // 2. Cek Cache\r\n            if (!forceRefresh) {\r\n                const cached = sessionStorage.getItem(cacheKey);\r\n                if (cached) {\r\n                    const { data: cachedData, timestamp } = JSON.parse(cached);\r\n                    if (Date.now() - timestamp < CACHE_DURATION) {\r\n                        setData(cachedData);\r\n                        setLoading(false);\r\n                        return; // Hemat Reads\r\n                    }\r\n                }\r\n            }\r\n\r\n            // 3. Fetch Data Real-time\r\n            const start = new Date(range.start); start.setHours(0,0,0,0);\r\n            const end = new Date(range.end); end.setHours(23,59,59,999);\r\n\r\n            // A. Sales (Revenue & COGS)\r\n            const qSales = query(\r\n                collection(db, \"sales_orders\"), \r\n                where(\"order_date\", \">=\", start), \r\n                where(\"order_date\", \"<=\", end)\r\n            );\r\n            const snapSales = await getDocs(qSales);\r\n            \r\n            let rev = 0, cogs = 0;\r\n            snapSales.forEach(d => { \r\n                const s = d.data(); \r\n                rev += (s.net_amount || 0); \r\n                cogs += (s.total_cost || 0); \r\n            });\r\n\r\n            // B. Expenses (Cash Out)\r\n            const qExp = query(\r\n                collection(db, \"cash_transactions\"), \r\n                where(\"date\", \">=\", start), \r\n                where(\"date\", \"<=\", end), \r\n                where(\"type\", \"==\", \"out\")\r\n            );\r\n            const snapExp = await getDocs(qExp);\r\n            \r\n            let expTotal = 0; \r\n            const expDet = {};\r\n            const exclude = ['pembelian', 'transfer', 'prive']; \r\n            \r\n            snapExp.forEach(d => {\r\n                const t = d.data(); \r\n                const cat = (t.category || 'Lainnya').toLowerCase();\r\n                // Filter kategori yang bukan expense operasional\r\n                if(!exclude.includes(cat)) { \r\n                    expTotal += t.amount; \r\n                    expDet[cat] = (expDet[cat] || 0) + t.amount; \r\n                }\r\n            });\r\n\r\n            const reportData = { revenue: rev, cogs: cogs, expenses: expTotal, details: expDet };\r\n            setData(reportData);\r\n\r\n            // 4. Simpan Cache\r\n            sessionStorage.setItem(cacheKey, JSON.stringify({\r\n                data: reportData,\r\n                timestamp: Date.now()\r\n            }));\r\n\r\n        } catch(e) { \r\n            console.error(e); \r\n        } finally { \r\n            setLoading(false); \r\n        }\r\n    };\r\n\r\n    useEffect(() => { \r\n        generateReport(); \r\n    }, []); // Load awal\r\n\r\n    const gross = data.revenue - data.cogs;\r\n    const net = gross - data.expenses;\r\n    const margin = data.revenue > 0 ? (net / data.revenue) * 100 : 0;\r\n\r\n    return (\r\n        <div className=\"max-w-4xl mx-auto space-y-8 fade-in pb-20\">\r\n            {/* Header & Filter */}\r\n            <div className=\"flex flex-col sm:flex-row justify-between items-end sm:items-center gap-4\">\r\n            <div>\r\n                <h2 className=\"text-xl md:text-3xl font-bold text-lumina-text font-display\">Profit & Loss</h2>\r\n                <p className=\"text-sm text-lumina-muted font-light\">Financial performance summary.</p>\r\n            </div>\r\n            {/* Filter & Refresh Button, tidak diubah */}\r\n            <div className=\"flex items-center gap-2 bg-lumina-surface p-1 rounded-lg border border-lumina-border shadow-lg\">\r\n                <input type=\"date\" className=\"text-sm bg-transparent text-lumina-text border-none focus:ring-0 outline-none px-2\" value={range.start} onChange={e=>setRange({...range, start:e.target.value})} />\r\n                <span className=\"text-lumina-muted\">-</span>\r\n                <input type=\"date\" className=\"text-sm bg-transparent text-lumina-text border-none focus:ring-0 outline-none px-2\" value={range.end} onChange={e=>setRange({...range, end:e.target.value})} />\r\n                <button onClick={() => generateReport(false)} className=\"btn-gold px-4 py-1 text-xs\">\r\n                {loading ? '...' : 'Filter'}\r\n                </button>\r\n                <button onClick={() => generateReport(true)} className=\"btn-ghost-dark px-3 py-1 text-xs border-l border-lumina-border ml-1\" title=\"Force Refresh\">\r\n                â†»\r\n                </button>\r\n            </div>\r\n            </div>\r\n\r\n\r\n            <div className=\"card-luxury p-8 space-y-8 relative overflow-hidden\">\r\n                {/* Decorative Glow */}\r\n                <div className=\"absolute top-0 left-1/2 -translate-x-1/2 w-2/3 h-1 bg-gradient-to-r from-transparent via-lumina-gold to-transparent opacity-50\"></div>\r\n\r\n                {/* REVENUE */}\r\n                <div>\r\n                    <h3 className=\"text-xs font-bold text-lumina-muted uppercase tracking-widest mb-3 border-b border-lumina-border pb-2\">Revenue</h3>\r\n                    <div className=\"flex justify-between items-center\">\r\n                        <span className=\"font-medium text-lumina-text\">Net Sales</span>\r\n                        <span className=\"font-bold text-xl text-white font-display\">{formatRupiah(data.revenue)}</span>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* COGS */}\r\n                <div>\r\n                    <h3 className=\"text-xs font-bold text-lumina-muted uppercase tracking-widest mb-3 border-b border-lumina-border pb-2\">Cost of Goods Sold</h3>\r\n                    <div className=\"flex justify-between items-center\">\r\n                        <span className=\"font-medium text-lumina-text\">HPP Product</span>\r\n                        <span className=\"font-bold text-lg text-rose-400 font-mono\">({formatRupiah(data.cogs)})</span>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* GROSS PROFIT */}\r\n                <div className=\"bg-lumina-highlight/40 p-5 rounded-xl border border-lumina-border flex justify-between items-center\">\r\n                    <span className=\"font-bold text-lumina-gold text-sm uppercase tracking-widest\">Gross Profit</span>\r\n                    <span className=\"font-extrabold text-2xl text-white font-display\">{formatRupiah(gross)}</span>\r\n                </div>\r\n\r\n                {/* EXPENSES */}\r\n                <div>\r\n                    <h3 className=\"text-xs font-bold text-lumina-muted uppercase tracking-widest mb-3 border-b border-lumina-border pb-2\">Operating Expenses</h3>\r\n                    <div className=\"space-y-3 pl-2 mb-4\">\r\n                        {Object.entries(data.details).map(([k, v]) => (\r\n                            <div key={k} className=\"flex justify-between text-sm\">\r\n                                <span className=\"capitalize text-lumina-text opacity-80\">{k}</span>\r\n                                <span className=\"font-mono text-lumina-text\">{formatRupiah(v)}</span>\r\n                            </div>\r\n                        ))}\r\n                        {data.expenses === 0 && <p className=\"text-sm text-lumina-muted italic\">No expenses recorded.</p>}\r\n                    </div>\r\n                    <div className=\"flex justify-between items-center border-t border-lumina-border pt-4 border-dashed\">\r\n                        <span className=\"font-bold text-lumina-text text-sm\">Total Expenses</span>\r\n                        <span className=\"font-bold text-rose-400 font-mono\">({formatRupiah(data.expenses)})</span>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* NET PROFIT */}\r\n                <div className=\"bg-gradient-to-r from-lumina-surface to-lumina-highlight p-8 rounded-2xl shadow-2xl border border-lumina-border flex justify-between items-center relative overflow-hidden\">\r\n                    <div className=\"relative z-10\">\r\n                        <span className=\"block text-lumina-muted text-xs font-bold uppercase tracking-widest mb-2\">Net Profit</span>\r\n                        <span className={`text-4xl font-display font-extrabold tracking-tight ${net < 0 ? 'text-rose-500' : 'text-emerald-400'}`}>{formatRupiah(net)}</span>\r\n                    </div>\r\n                    <div className=\"relative z-10 text-right\">\r\n                        <span className=\"block text-lumina-muted text-xs mb-1\">Net Margin</span>\r\n                        <span className={`text-2xl font-bold font-mono ${margin >= 0 ? 'text-emerald-400' : 'text-rose-500'}`}>{margin.toFixed(1)}%</span>\r\n                    </div>\r\n                    \r\n                    {/* Glow Effect based on Profit */}\r\n                    <div className={`absolute -right-10 -bottom-10 w-48 h-48 rounded-full blur-3xl opacity-10 ${net >= 0 ? 'bg-emerald-500' : 'bg-rose-500'}`}></div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}"],"names":[],"mappings":"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"}}]
}